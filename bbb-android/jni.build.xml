<?xml version="1.0" encoding="UTF-8"?>

<project name="bbb-android-jni" basedir="." default="all">
	<property name="ndk.dir" value="../../android-ndk-r4-crystax"/>
	<property name="ndk.build" value="${ndk.dir}/ndk-build"/>
	<property name="bash" value="/bin/bash"/>
	<property name="echo" value="/bin/echo"/>

	<target name="init">
		<copy toDir="obj/local/armeabi/" preservelastmodified="true">
			<fileset dir="libs/armeabi/" includes="*.so"/>
		</copy>
	</target>

    <target name="clean">
        <delete includeemptydirs="true" failonerror="false">
            <fileset dir="obj/"/>
        </delete>      
    </target>

	<macrodef name="build">
		<attribute name="target"/>
		<sequential>
			<exec executable="${echo}" output="jni/Application.mk">
				<arg value="APP_MODULES := @{target}"/>
			</exec>
			<exec executable="${ndk.build}"/>
		</sequential>
	</macrodef>
	
	<target name="mconfnative" depends="init">
		<build target="mconfnative"/>
		<antcall target="install"/>
	</target>
	
	<target name="ffmpeg" depends="init">
		<build target="avutil avformat avcodec swscale"/>
		<antcall target="install"/>
	</target>
	
	<target name="iva" depends="init">
		<build target="thread common queue decode"/>
		<antcall target="install"/>
	</target>
	
	<target name="install">
		<copy toDir="libs/armeabi/" preservelastmodified="true">
			<fileset dir="obj/local/armeabi/" includes="*.so"/>
		</copy>
	</target>
	
	<target name="all" depends="ffmpeg,iva,mconfnative"/>
</project>
